#! /bin/sh

# Fonction that update version number (ie line that contains "Siconos version" in all files of the 
# directory given in argument
udpateDir()
{
initDir=`pwd`
cd $1
for i in `ls`
do
if test -f $i
then 
testFic=`head -10 $i | grep "Siconos-Kernel version"`
testFic2=`head -100 $i | grep "\\version"`
# xml comment line must ended with -->
isXml=`find ./$i -name "*.xml" -print`
# special case: siconos.in because of cartridge function.
isSiconosIn=`find ./$i -name "siconos.in" -print`
if test ${#testFic} -gt 15
then 
if test $isXml
then sed '1,10s/Siconos-Kernel version.*$/Siconos-Kernel version 1.1.3, Copyright INRIA 2005-2006.-->/' $i > Bob
elif test $isSiconosIn
then sed -e '1,100s/| Siconos-Kernel version 1.1.2, Copyright INRIA 2005-2006.|/| Siconos-Kernel version 1.1.3, Copyright INRIA 2005-2006.|/' -e '1,100s/# Siconos-Kernel version 1.1.2, Copyright INRIA 2005-2006./# Siconos-Kernel version 1.1.3, Copyright INRIA 2005-2006./' $i > Bob
else 
sed '1,10s/Siconos-Kernel version.*$/Siconos-Kernel version 1.1.3, Copyright INRIA 2005-2006./' $i > Bob
fi
#echo "Update "$i
mv Bob $i
else echo "no update for "$1"/"$i
fi
#second sed, for \version in .h
if test ${#testFic2} -gt 8
then 
sed '1,100s/\\version 1.1.2.*$/\\version 1.1.3./' $i > Bob
#echo "Update "$i
mv Bob $i
fi
fi
done
cd $initDir
}

version="1.1.3"
BASEDIR=`pwd`
#echo $BASEDIR

rep=`basename $BASEDIR`
#echo $rep

if test "$rep" = "Numerics"
    then echo "===== Update Version Number in Numerics =====";
    cd config
    sed '1,100s/PROJECT_NUMBER.*$/PROJECT_NUMBER         = v1.1.3/' DoxygenNumerics.cfg > Bob
    mv Bob DoxygenNumerics.cfg
    cd ..
    udpateDir "./";
    chmod 755 ./autogen.sh
# Update files in Numerics/currentDir
#for currentDir in `ls -l | grep '^d' | awk '{print $9}'`
#do 
#updateDir "./"$currentDir
#done
  udpateDir "./api";
  udpateDir "./api/matlab";
  udpateDir "./config";
  udpateDir "./macros";
  udpateDir "./src";
  udpateDir "./src/NSSpack";
  udpateDir "./src/NSSpack/test";
  udpateDir "./src/odepack";
  udpateDir "./src/odepack/test";
  udpateDir "./src/utils";
elif test "$rep" = "Kernel"
then echo "===== Update Version Number in Kernel ====="
    cd config
    sed '1,100s/PROJECT_NUMBER.*$/PROJECT_NUMBER         = v1.1.3/' DoxygenSiconos.cfg > Bob
    mv Bob DoxygenSiconos.cfg
    cd ..
udpateDir "./";
  chmod 755 ./autogen.sh
udpateDir "./config";
udpateDir "./config/xmlschema";
udpateDir "./macros";
udpateDir "./siconos";
udpateDir "./test/LagrangianDSTests";
udpateDir "./test/LinearDSTests";
udpateDir "./src";
udpateDir "./src/apiC"
udpateDir "./src/model"
udpateDir "./src/model/test"
udpateDir "./src/modelingTools"
udpateDir "./src/modelingTools/test"
udpateDir "./src/simulationTools"
#udpateDir "./src/simulationTools/test"
udpateDir "./src/plugin"
udpateDir "./src/plugin/test"
udpateDir "./src/xml"
udpateDir "./src/xml/test"
udpateDir "./src/utils"
udpateDir "./src/utils/contract/"
udpateDir "./src/utils/SiconosAlgebra"
udpateDir "./src/utils/SiconosAlgebra/test"
udpateDir "./src/utils/SiconosException/"
udpateDir "./src/utils/SiconosMemory"
udpateDir "./src/utils/SiconosMemory/test"
udpateDir "./src/utils/SiconosSharedLibrary"
elif test "$rep" = "Front-End"
then     echo "===== Update Version Number in Front-End ====="
  chmod 755 ./autogen.sh
udpateDir "./";
udpateDir "./config";
udpateDir "./macros";
udpateDir "./python";
udpateDir "./python/pySiconos";
udpateDir "./python/test";
udpateDir "./scilab";
elif test "$rep" = "sample"
then echo "===== Update Version Number in sample ====="
#for currentDir in `ls -l | grep '^d' | awk '{print $9}'`
#do 
#dir="./"$rep"/"$currentDir
#echo $dir
#updateDir  $dir
#done
udpateDir "./Ball2D"
udpateDir "./CircuitRLCD"
udpateDir "./DoubleContact"
udpateDir "./main_siconos"
udpateDir "./RollBouncingBall"
udpateDir "./Bar2D"
udpateDir "./DiodeBridge"
udpateDir "./DryFrictionOscillator"
udpateDir "./MultiBeadsColumn"
udpateDir "./RollingBalls"
udpateDir "./BeadOnAPlan_Friction2D" 
udpateDir "./DiodeBridgeCapFilter"
udpateDir "./FrictionRollingBalls"
udpateDir "./Oscillator"
udpateDir "./ThreeBeadsColumn"
udpateDir "./BouncingBall"
udpateDir "./DiodeBridgePowSup"
udpateDir "./HuMAns_pa10"
udpateDir "./PRC"
fi

