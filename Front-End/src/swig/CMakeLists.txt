FIND_PACKAGE(SWIG REQUIRED)
INCLUDE(${SWIG_USE_FILE})

FIND_PACKAGE(PythonLibs)
INCLUDE_DIRECTORIES(${PYTHON_INCLUDE_PATH})

INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})

COMPILE_WITH(SiconosNumerics REQUIRED)
COMPILE_WITH(SiconosKernel REQUIRED)

COMPILE_WITH(Boost REQUIRED)
FIND_PACKAGE(Boost COMPONENTS graph)

IF(NOT Boost_GRAPH_FOUND)
  MESSAGE(FATAL_ERROR "boost graph library is needed.")
ENDIF(NOT Boost_GRAPH_FOUND)



COMPILE_WITH(LibXml2 REQUIRED)
COMPILE_WITH(GMP REQUIRED)
COMPILE_WITH(ATLAS)


COMPILE_WITH(LAPACK REQUIRED COMPLETE)
COMPILE_WITH(BLAS REQUIRED)

SET(CMAKE_SWIG_FLAGS "")

SET_SOURCE_FILES_PROPERTIES(Siconos.i PROPERTIES CPLUSPLUS ON)
#SET_SOURCE_FILES_PROPERTIES(Siconos.i PROPERTIES SWIG_FLAGS "-includeall")

SWIG_ADD_MODULE(Siconos python Siconos.i)

SWIG_LINK_LIBRARIES(Siconos ${PYTHON_LIBRARIES} ${SiconosKernel_LIBRARIES} ${SiconosNumerics_LIBRARIES} ${FORTRAN_LIBRARIES} ${Boost_LIBRARIES})



# consider distutils ...
GET_FILENAME_COMPONENT(_P "${PYTHON_LIBRARIES}" PATH)
GET_FILENAME_COMPONENT(_PP "${_P}" PATH)
GET_FILENAME_COMPONENT(_PPN "${_PP}" NAME)
MESSAGE(STATUS "${_PPN}")

INSTALL(PROGRAMS ${CMAKE_CURRENT_BINARY_DIR}/Siconos.py DESTINATION lib/${_PPN}/dist-packages)
INSTALL(TARGETS ${SWIG_MODULE_Siconos_REAL_NAME}  LIBRARY DESTINATION lib/${_PPN}/dist-packages)

ENABLE_TESTING()

ADD_TEST(basic ${CMAKE_CURRENT_SOURCE_DIR}/test/basic.py)
