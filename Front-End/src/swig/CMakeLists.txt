FIND_PACKAGE(SWIG REQUIRED)
INCLUDE(${SWIG_USE_FILE})

FIND_PACKAGE(PythonLibs)
INCLUDE_DIRECTORIES(${PYTHON_INCLUDE_PATH})

INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})

COMPILE_WITH(SiconosNumerics REQUIRED)
COMPILE_WITH(SiconosKernel REQUIRED)

COMPILE_WITH(Boost REQUIRED)
FIND_PACKAGE(Boost COMPONENTS graph)

IF(NOT Boost_GRAPH_FOUND)
  MESSAGE(FATAL_ERROR "boost graph library is needed.")
ENDIF(NOT Boost_GRAPH_FOUND)



COMPILE_WITH(LibXml2 REQUIRED)
COMPILE_WITH(GMP REQUIRED)
COMPILE_WITH(ATLAS)


COMPILE_WITH(LAPACK REQUIRED COMPLETE)
COMPILE_WITH(BLAS REQUIRED)

SET(CMAKE_SWIG_FLAGS "")

SET_SOURCE_FILES_PROPERTIES(SiconosNumerics.i PROPERTIES CPLUSPLUS ON)
#SET_SOURCE_FILES_PROPERTIES(SiconosNumerics.i PROPERTIES SWIG_FLAGS "-includeall")

SWIG_ADD_MODULE(SiconosNumerics python SiconosNumerics.i)

SWIG_LINK_LIBRARIES(SiconosNumerics ${PYTHON_LIBRARIES} ${SiconosKernel_LIBRARIES} ${SiconosNumerics_LIBRARIES} ${FORTRAN_LIBRARIES} ${Boost_LIBRARIES})

CONFIGURE_FILE(setup.py.in setup.py)

# consider distutils ...
GET_FILENAME_COMPONENT(_P "${PYTHON_LIBRARIES}" PATH)
GET_FILENAME_COMPONENT(_PP "${_P}" PATH)
GET_FILENAME_COMPONENT(_PPN "${_PP}" NAME)
MESSAGE(STATUS "${_PPN}")

# this fails if python libraries are not under CMAKE_PREFIX!
# so please consider distutils...
INSTALL(PROGRAMS ${CMAKE_CURRENT_BINARY_DIR}/SiconosNumerics.py DESTINATION lib/${_PPN}/dist-packages)

MESSAGE(STATUS "swig module: ${SWIG_MODULE_SiconosNumerics_REAL_NAME}")
INSTALL(TARGETS ${SWIG_MODULE_SiconosNumerics_REAL_NAME}  LIBRARY DESTINATION lib/${_PPN}/dist-packages)

ENABLE_TESTING()

ADD_TEST(lcp ${CMAKE_CURRENT_SOURCE_DIR}/tests/lcp.py)
