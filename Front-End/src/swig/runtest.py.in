#!/usr/bin/env ${PYTHON_EXECUTABLE}

import sys
import os
from subprocess import check_call


def returnWinePrefix():
    if 'WINEPREFIX' in os.environ:
        return  os.environ['WINEPREFIX']
    else:
        return os.environ['HOME'] + "/.wine"


# 2. test command
if "${EMULATOR}" == "":
    args = []
else:
    args = ["${EMULATOR}"]

args.extend(["py.test${EXE_EXT}", "-v", sys.argv[1]])
check_call(args,
           env={"PYTHONPATH": os.path.join(
               "${DRIVE_LETTER}${CMAKE_BINARY_DIR}","src","swig") + \
                "${VAR_SEPARATOR}" + \
                os.path.join("${DRIVE_LETTER}${CMAKE_CURRENT_SOURCE_DIR}",
                             "Siconos",
                             "functions"),
                "PYTHONDONTWRITEBYTECODE": "1",
                "LD_LIBRARY_PATH": os.path.curdir,
                "HOME": os.environ['HOME'],
                "WINEPREFIX": returnWinePrefix(),
                "Path": "${SICONOS_NUMERICS_PATH};" + os.getenv('Path', default='')})
